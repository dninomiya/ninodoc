# Web アプリ開発の世界観

## Web アプリはどのように作られるのか

主に HTML, CSS, JavaScript といった言語を使って開発を行います。家にたとえると以下のような役割があります。

- HTML - 壁、椅子、電球などのものを作る
- CSS - 物の色、大きさな、柄など見た目を調整する
- JavaScript - 電気を通して電球を操作できるようにする

実際の画面にたとえると以下のようになります。

<div style={{padding: '16px', border: '1px solid #ccc', marginBottom: '1.4em', borderRadius: '4px'}}>
<p style={{margin: 0}}>この文字は HTML で作られています。<br /><span style={{color: 'red'}}>文字の色や大きさは CSS で調整されています。</span><br /><button onClick={() => alert('こんにちは')}>JavaScript で操作を受け付けます（クリックしてください）</button></p>
</div>

Web サイトなどはこうやって作られますが、Web アプリになるとログイン機能やデータベースにユーザーの情報を保存する機能が必要だったりと、より多くの知識が必要になります。

HTML と CSS、 JavaScript だけでそれをやるのはかなり無理があります。建築に例えると木材と釘だけ渡されて素手で頑張れと言われるような状況です。

そこで登場するのがライブラリです。ライブラリはパッケージと呼ばれることもありますが、建築で言うところの小道具（電動ドリルや金槌など）です。ただ、小道具と資材だけ渡されて家を建てろと言われてもまだ何から始めていいのか分からないと思います。そこで登場するのがフレームワークです。フレームワークは骨格を意味し、建築でいう骨組みです。フレームワークを使えば基本的な家の形ができているので手探りで作業する必要はなくなります。

## フレームワークとライブラリ

建築と同じでメインのフレームワークは基本的に 1 つ選択するのですが、ライブラリは必要に応じて適宜組み合わせます。庭を作るときの道具セットと内装を作る際に使う道具が違うのと同じです。

![](/img/docs/library-framework.png)

フレームワークやライブラリを選択する際は”もっとも使われているもの”を選ぶことをオススメします。ユーザーが多いと多くの情報が集まるのでトラブルを解決しやすく、また就職や転職でも選択肢が増えます。

結論としては以下がオススメです。

- フレームワーク: [Next.js](https://nextjs.org/)
- ライブラリ: [React](https://ja.reactjs.org/)

Next.js は現在 Web アプリ開発において世界中で[圧倒的な支持](https://2022.stateofjs.com/ja-JP/libraries/rendering-frameworks/)を受けています。Next.js は React の上に成り立つのでライブラリも必然的に React を使うことになります。

ライブラリについては要件に応じて都度最適なライブラリを選択することになります。たとえばスライドショーを作りたいのであれば [Swiper](https://swiperjs.com/) のようなライブラリを使います。

## TypeScript

前述したフレームワークやライブラリは、今ではほとんど TypeScript をベースにしています。[TypeScript](https://www.typescriptlang.org/) は JavaScript を拡張した言語です。**JavaScript に単に型という機能を加えたもの**なので、実態ほほとんど JavaScript と同じです。**型は安全装置のようなもの**で、間違った実装を未然に防いでくれる効果があります。

たとえば JavaScript では変数に何でも代入できますが、そのせいで変数が意図しない使われ方をしてバグの原因になることが多々あります。たとえば以下のケースを見てください。

```js
var userAge; // ユーザーの年齢を入れる変数
userAge = '10歳';

// 10年後の年齢を表示したい
console.log(`10年後の年齢は` + userAge + 10 'です');
```

上記の結果、 `10年後の年齢は10歳10です。` と表示されます。これは `userAge` というユーザーの年齢を期待する変数に対し `10歳` という文字列を代入したことが原因です。JavaScript では文字列に対し加算を行うと数字が文字列として結合されるため、`10歳10` という結果になります。

TypeScript の場合以下のようにしてこの事故を防ぐことができます。

```ts
var userAge: number; // ユーザーの年齢を"数字縛りで"入れる変数
userAge = '10歳'; // 文字列なのでエディターに怒られる
userAge = 10; // 数字なので怒られない

// 以下同文
```

変数に対し「どの形式の値（型）を許可するか？」を明示的に指定することで、それ以外の値が代入された場合にエディターが警告を表示してくれます。

現在ではあらゆる場面で JavaScript に変わって TypeScript が使われるようになっているので、これから学習する人は TypeScript を学ぶようにしましょう。とはいえ前述したように** TypeScript は JavaScript で型を使えるようにしただけの存在** なので、まったく新しい別の言語を覚えるというよりは JavaScript を理解した上で TypeScript を学ぶだけで OK です。

## ビルドツール

アプリ開発ではビルドツールというものが存在します。前述した TypeScript は JavaScript を拡張した物なので厳密には JavaScript ではなくなっています。我々が普段利用するブラウザは JavaScript の理解と実行はできますが TypeScript は理解できません。なので最終的には TypeScript を JavaScript に変換する必要があります。

その変換を行うのがビルドツールです。ビルドツールは変換だけでなくビルドの過程で複数のコードを効率よく繋ぎ合わせたたり空行や余白を除去してコードの容量を減らすなど、コードの最適化も合わせて行ってくれます。

このビルドツールはこれまで [webpack](https://webpack.js.org/) と呼ばれるものが使われてきました。Next.js のようなフレームワークも内部的に webpack が使われていたのですが、最近になって Next.js を開発する Vercel 社が [Turbopack](https://turbo.build/pack) と呼ばれるビルドツールをリリースし、[今後 Turbopack が台頭する可能性が高い](https://turbo.build/pack/docs/comparisons/webpack)状況です。

とはいえもはやビルドツールはフレームワークが内部的に利用するものであり、我々が直接意識する機会はほとんどありません。自動車がどんなエンジンを積んでいるかという話に近いので、フレームワークを普通に使う分にはとくに意識しなくて OK です。

## テスト

作ったアプリはテストをした上でリリースします。テストにはさまざまな種類がありますが、大きく分けると人間が実際に操作して目視するテストと、プログラムで機械的に行うテストの 2 パターンに分かれます。

人間が行うテストの場合画面ごとに想定されるアクションを書き出し、それに沿って実態に操作して動きを確かめる形で進めます。ただこの方法はコードをアップデートするたびに毎回人力でテストする必要があるのでかなり効率の悪いアプローチになります。

機械的なテストの場合、必要な機能を人間の代わりにプログラムが実行し、正しく実行されていることをプログラムが判断する形で進めます。

機械的なテストは E2E テストと単体テストに分けることができます。単体テストは自動車でいうならばタイヤはパンクしてないか？ドアの開閉はできるか？という部品単位でのテストになります。それに対し E2E テストは「ドアを開けて自動車に乗ってエンジンをかけて走ること」という、ユーザーが実際に行うであろう一連の動作をプログラムが実行する形でテストします。

単体テストだけ行う場合、たとえばタイヤ自体に問題はなかったがタイヤを 1 つしか付けてなかった。という状況を見落とし、結果として動かない。ということが起きてしまいます。実際の行動に準ずる E2E テストは安心度が高いのですが、その分テストに毎回時間がかかります。

そのためプロジェクトによって単体テストや E2E テストを適宜使い分けながらテストを行なっています。

テストは書くのが面倒なのでついつい後回しにしてしまいがちですが一度書いてしまうと長くアプリの動作を保証してくれるので、トータルで見ると将来の工数を大きく削減してくれます。
